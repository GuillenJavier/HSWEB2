{% extends "_layout.html" %}
{% block content %}
<div class="container py-4" style="max-width: 820px;">
  <div class="card shadow-sm">
    <div class="card-body">
      <h3 class="card-title mb-3">Agendar cita para paciente registrado</h3>
      <p class="text-muted mb-4">Selecciona el paciente, el médico (si aplica) y define el horario.</p>

      <form method="post">
        <div class="row g-3">
          <!-- Paciente -->
          <div class="col-md-12">
            <label class="form-label">Paciente</label>
            <select class="form-select" name="paciente_id" required>
              <option value="" disabled selected>Elige un paciente…</option>
              {% for p in pacientes %}
                <option value="{{ p.id }}">
                  {{ p.apellido }}, {{ p.nombre }} — {{ p.email }}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- Médico -->
          <div class="col-md-12">
            <label class="form-label">Médico</label>
            <select class="form-select" name="medico_id" required>
              {% for m in medicos %}
                <option value="{{ m.id }}"
                        {% if medico_actual and medico_actual.id == m.id %}selected{% endif %}>
                  Dr(a). {{ m.usuario.nombre }} {{ m.usuario.apellido }} — {{ m.especialidad }}
                </option>
              {% endfor %}
            </select>
            {% if medico_actual %}
              <small class="text-muted">Agendando como: Dr(a). {{ medico_actual.usuario.nombre }} {{ medico_actual.usuario.apellido }}</small>
            {% endif %}
          </div>

          <!-- Inicio / Fin -->
          <div class="col-md-6">
            <label class="form-label">Fecha y hora de inicio</label>
            <input type="datetime-local" class="form-control" name="start_at" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Fecha y hora de fin</label>
            <input type="datetime-local" class="form-control" name="end_at" required>
          </div>

          <!-- Notas -->
          <div class="col-12">
            <label class="form-label">Notas (opcional)</label>
            <textarea name="notas" class="form-control" rows="3" placeholder="Motivo, observaciones…"></textarea>
          </div>
        </div>

        <div class="d-flex gap-2 mt-4">
          <button class="btn btn-success" type="submit">Guardar cita</button>
          <a class="btn btn-outline-secondary" href="{{ url_for('doctor_consultas') }}">Volver</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
